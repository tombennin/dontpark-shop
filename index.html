<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DontPark.ai</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8em;
            font-weight: 700;
        }
        
        .shop-info {
            text-align: right;
        }
        
        .claude-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid #3b82f6;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #1e3a8a;
        }
        
        .stat-label {
            color: #64748b;
            font-weight: 500;
            margin-top: 5px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .bookings-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8fafc;
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            font-size: 1.2em;
            color: #1e3a8a;
        }
        
        .booking-card {
            padding: 25px;
            border-bottom: 1px solid #f1f5f9;
            transition: background 0.2s;
        }
        
        .booking-card:hover {
            background: #f8fafc;
        }
        
        .booking-card:last-child {
            border-bottom: none;
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .customer-info {
            flex: 1;
        }
        
        .customer-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 5px;
        }
        
        .vehicle-info {
            color: #64748b;
            margin-bottom: 10px;
        }
        
        .booking-reference {
            color: #64748b;
            font-size: 0.9em;
            margin-top: 5px;
            padding: 8px 12px;
            background: #f8fafc;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        
        .flight-info {
            background: #dbeafe;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            color: #1e40af;
            margin-bottom: 15px;
        }
        
        .claude-diagnosis {
            background: #f0f9ff;
            border: 2px solid #bae6fd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .claude-diagnosis h4 {
            color: #1e40af;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .diagnosis-text {
            color: #374151;
            line-height: 1.5;
        }
        
        .revenue-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #1e40af;
        }
        
        .revenue-info.completed {
            background: #f0fdf4;
            border-color: #bbf7d0;
            color: #166534;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .chat-with-claude {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: #f8fafc;
        }
        
        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 10px;
            max-width: 85%;
        }
        
        .user-message {
            background: #3b82f6;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .claude-message {
            background: white;
            border: 1px solid #e2e8f0;
            margin-right: auto;
        }
        
        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .chat-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            resize: none;
            height: 60px;
        }
        
        .quick-actions {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 25px;
        }
        
        .quick-action {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            text-decoration: none;
            color: #374151;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .quick-action:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-new {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-confirmed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-in-progress {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .notification {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            color: white;
            background: #10b981;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        🔄 Connecting to database...
    </div>

    <div class="header">
        <div class="header-content">
            <div class="logo">DontPark.ai</div>
            <div class="shop-info">
                <div class="claude-badge">Claude AI Powered ✨</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="todayBookings">-</div>
                <div class="stat-label">Today's Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayRevenue">-</div>
                <div class="stat-label">Today's Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalBookings">-</div>
                <div class="stat-label">Total Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">4.9⭐</div>
                <div class="stat-label">Average Rating</div>
            </div>
        </div>

        <!-- Flight Delay Notification -->
        <div class="notification" id="flightNotification" style="display: none;">
            ⚠️ <strong>Flight Alert:</strong> <span id="flightAlertText"></span>
        </div>

        <div class="main-content">
            <!-- Bookings Section -->
            <div class="bookings-section">
                <div class="section-header">Today's Bookings & Services</div>
                <div id="bookingsContainer">
                    <div class="booking-card">
                        <div style="text-align: center; padding: 40px; color: #64748b;">
                            <div style="font-size: 3em; margin-bottom: 20px;">📊</div>
                            <div>Loading bookings from database...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Chat with Claude -->
                <div class="chat-with-claude">
                    <div class="section-header">Ask Claude Anything</div>
                    <div class="chat-messages" id="claudeChat">
                        <div class="chat-message claude-message">
                            <strong>Claude:</strong> Hi! I'm here to help with any automotive questions. What would you like to know?
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <textarea class="chat-input" placeholder="Ask Claude about diagnostics, customer communication, or anything else..." onkeypress="handleChatKeyPress(event)"></textarea>
                        <button class="btn btn-primary" style="margin-top: 10px; width: 100%;" onclick="sendToClaude()">Ask Claude</button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="section-header" style="padding: 0; background: none; border: none; margin-bottom: 15px;">Quick Actions</div>
                    <a href="#" class="quick-action" onclick="refreshData()">🔄 Refresh Data</a>
                    <a href="#" class="quick-action" onclick="createTestBooking()">➕ Create Test Booking</a>
                    <a href="#" class="quick-action" onclick="viewAllBookings()">📋 View All Bookings</a>
                    <a href="#" class="quick-action" onclick="customerFeedback()">⭐ Customer Feedback</a>
                </div>
            </div>
        </div>
    </div>

    <script>
// Add this function (can go anywhere in your script section)
function refreshData() {
    loadAllData();
}
        
        // Built-in Supabase client (same as before)
        class SimpleSupabaseClient {
            constructor(url, key) {
                this.url = url;
                this.key = key;
                this.headers = {
                    'apikey': key,
                    'Authorization': `Bearer ${key}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=representation'
                };
            }
            
            from(table) {
                return new SupabaseTable(this.url, this.headers, table);
            }
        }
        
        class SupabaseTable {
            constructor(baseUrl, headers, table) {
                this.baseUrl = baseUrl;
                this.headers = headers;
                this.table = table;
            }
            
            select(columns = '*') {
                return new SupabaseQuery(this.baseUrl, this.headers, this.table, 'SELECT', columns);
            }
            
            insert(data) {
                return new SupabaseQuery(this.baseUrl, this.headers, this.table, 'INSERT', '*', data);
            }
        }
        
        class SupabaseQuery {
            constructor(baseUrl, headers, table, method, columns = '*', data = null) {
                this.baseUrl = baseUrl;
                this.headers = headers;
                this.table = table;
                this.method = method;
                this.columns = columns;
                this.data = data;
                this.filters = [];
                this.orderBy = null;
                this.limitCount = null;
            }
            
            order(column, options = {}) {
                const direction = options.ascending === false ? 'desc' : 'asc';
                this.orderBy = `${column}.${direction}`;
                return this;
            }
            
            limit(count) {
                this.limitCount = count;
                return this;
            }
            
            async execute() {
                try {
                    const url = `${this.baseUrl}/rest/v1/${this.table}`;
                    const params = new URLSearchParams();
                    
                    if (this.method === 'SELECT') {
                        if (this.columns !== '*') params.append('select', this.columns);
                        if (this.orderBy) params.append('order', this.orderBy);
                        if (this.limitCount) params.append('limit', this.limitCount);
                    }
                    
                    const queryString = params.toString();
                    const fetchUrl = queryString ? `${url}?${queryString}` : url;
                    
                    const options = {
                        method: this.method === 'SELECT' ? 'GET' : 'POST',
                        headers: this.headers
                    };
                    
                    if (this.data && this.method === 'INSERT') {
                        options.body = JSON.stringify(this.data);
                    }
                    
                    const response = await fetch(fetchUrl, options);
                    const result = await response.text();
                    
                    if (!response.ok) {
                        let errorData;
                        try {
                            errorData = JSON.parse(result);
                        } catch {
                            errorData = { message: result || 'Unknown error' };
                        }
                        return { data: null, error: errorData };
                    }
                    
                    let data = null;
                    if (result) {
                        try {
                            data = JSON.parse(result);
                        } catch {
                            data = result;
                        }
                    }
                    
                    return { data, error: null };
                    
                } catch (error) {
                    return { data: null, error: { message: error.message } };
                }
            }
        }
        
        // Initialize Supabase
        const supabase = new SimpleSupabaseClient(
            'https://uhrhukcovvvbmopvoncr.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVocmh1a2NvdnZ2Ym1vcHZvbmNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1MzIyMzcsImV4cCI6MjA3MDEwODIzN30.Ce69ktLB8h_OMe0H1XpDmRjKZawGlb59ProIs8UEaRw'
        );
        
        // Global variables
        let allBookings = [];
        
        // Utility functions
        function updateConnectionStatus(message, isSuccess = true) {
            const status = document.getElementById('connectionStatus');
            status.textContent = message;
            status.style.background = isSuccess ? '#10b981' : '#ef4444';
            
            // Auto-hide after 3 seconds if successful
            if (isSuccess) {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }
        
        // Data loading functions
        async function loadAllData() {
            updateConnectionStatus('🔄 Loading data...');
            
            try {
                console.log('🔍 Attempting to load bookings...');
                
                const { data, error } = await supabase
                    .from('bookings')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .execute();
                
                console.log('📊 Raw response:', { data, error });
                
                if (error) {
                    console.error('❌ Error object:', error);
                    const errorMessage = error.message || error.error_description || error.details || JSON.stringify(error);
                    updateConnectionStatus('❌ Database error: ' + errorMessage, false);
                    
                    // Show a more helpful error in the bookings area
                    const container = document.getElementById('bookingsContainer');
                    container.innerHTML = `
                        <div class="booking-card">
                            <div style="text-align: center; padding: 40px; color: #ef4444;">
                                <div style="font-size: 3em; margin-bottom: 20px;">⚠️</div>
                                <div><strong>Database Error:</strong></div>
                                <div style="margin: 10px 0; font-family: monospace; background: #fef2f2; padding: 10px; border-radius: 4px;">
                                    ${errorMessage}
                                </div>
                                <button class="btn btn-primary" onclick="loadAllData()" style="margin-top: 20px;">Retry</button>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                console.log('✅ Successfully loaded data:', data);
                allBookings = data || [];
                updateStats();
                displayBookings();
                updateConnectionStatus('✅ Data loaded successfully');
                
            } catch (error) {
                console.error('💥 Exception in loadAllData:', error);
                updateConnectionStatus('❌ Connection failed: ' + error.message, false);
            }
        }
        
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = allBookings.filter(b => b.created_at?.startsWith(today));
            
            document.getElementById('todayBookings').textContent = todayBookings.length;
            document.getElementById('todayRevenue').textContent = '$' + (todayBookings.length * 280);
            document.getElementById('totalBookings').textContent = allBookings.length;
        }
        
      // Fixed displayBookings function for dontpark.ai - matches your existing database
function displayBookings() {
    const container = document.getElementById('bookingsContainer');
    
    if (!allBookings || allBookings.length === 0) {
        container.innerHTML = `
            <div class="booking-card">
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <div style="font-size: 3em; margin-bottom: 20px;">📭</div>
                    <div>No bookings found</div>
                    <button class="btn btn-primary" onclick="createTestBooking()" style="margin-top: 20px;">Create Test Booking</button>
                </div>
            </div>
        `;
        return;
    }
    
    const bookingsHTML = allBookings.slice(0, 5).map(booking => {
        // Parse service description if it exists and is JSON
        let claudeRecommendation = null;
        if (booking.service_description) {
            try {
                claudeRecommendation = JSON.parse(booking.service_description);
            } catch (e) {
                // If not JSON, treat as plain text
                claudeRecommendation = { service: 'Service Request', description: booking.service_description, cost: booking.estimated_cost || 0 };
            }
        }
        
        // Build vehicle info from YOUR database columns
        const vehicleInfo = `${booking.year || ''} ${booking.Make_model || booking.car_make || ''} • ${booking.color || ''} • Plate: ${booking.license_plate || 'N/A'}`.replace(/\s+/g, ' ').trim();
        
        // Build flight info from YOUR columns
        const flightInfo = `Departure: ${booking.flight_date || 'N/A'} at ${booking.flight_time || 'N/A'} | Return: ${booking.return_date || 'N/A'} at ${booking.arrival_time || 'N/A'}`;
        
        // Get the customer issue description
        const customerIssue = booking.customer_notes || booking.claude_conversation || 'No specific issue described';
        
        return `
            <div class="booking-card">
                <div class="booking-header">
                    <div class="customer-info">
                        <div class="customer-name">
                            ${booking.customer_name || 'Unknown Customer'} 
                            <span class="status-badge status-${(booking.status || 'new').replace('-', '')}">${(booking.status || 'NEW').toUpperCase()}</span>
                        </div>
                        <div class="vehicle-info">${vehicleInfo}</div>
                        <div class="booking-reference">
                            <strong>Contact:</strong> ${booking.customer_phone || 'N/A'} • ${booking.customer_email || 'N/A'}
                        </div>
                        <div class="booking-reference">
                            <strong>Booking ID:</strong> ${booking.dontpark_booking_id || booking.id} | 
                            <strong>Created:</strong> ${new Date(booking.created_at).toLocaleDateString()}
                            ${booking.car_mileage ? ` | <strong>Miles:</strong> ${booking.car_mileage}` : ''}
                        </div>
                    </div>
                </div>
                
                <div class="flight-info">
                    ✈️ <strong>Flight Details:</strong> ${flightInfo}
                </div>
                
                <div class="claude-diagnosis">
                    <h4>🤖 Customer Issue & Claude AI Analysis</h4>
                    <div class="diagnosis-text">
                        <strong>Customer Description:</strong> ${customerIssue}<br><br>
                        ${claudeRecommendation ? `
                            <strong>Claude Recommendation:</strong> ${claudeRecommendation.service}<br>
                            ${claudeRecommendation.description}
                        ` : 'Awaiting diagnostic analysis...'}
                    </div>
                </div>
                
                <div class="revenue-info ${(booking.status || '').includes('completed') ? 'completed' : ''}">
                    <strong>Estimated:</strong> $${booking.estimated_cost || claudeRecommendation?.cost || 280} • 
                    ${booking.final_cost ? `<strong>Final:</strong> $${booking.final_cost} • ` : ''}
                    <strong>Status:</strong> ${booking.status || 'New Booking'}
                    ${booking.commission_amount ? ` • <strong>Commission:</strong> $${booking.commission_amount}` : ''}
                </div>
                
                ${booking.shop_notes ? `
                    <div style="background: #fef3c7; padding: 10px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #f59e0b;">
                        <strong>Shop Notes:</strong> ${booking.shop_notes}
                    </div>
                ` : ''}
                
                ${booking.internal_notes ? `
                    <div style="background: #f3f4f6; padding: 10px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #6b7280;">
                        <strong>Internal Notes:</strong> ${booking.internal_notes}
                    </div>
                ` : ''}
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="updateBookingStatus('${booking.id}', '${booking.customer_name || 'Customer'}')">Update Status</button>
                    <button class="btn btn-secondary" onclick="contactCustomer('${booking.customer_phone || ''}', '${booking.customer_email || ''}')">Contact Customer</button>
                    <button class="btn btn-success" onclick="viewFullDetails('${booking.id}')">Full Details</button>
                    ${booking.status === 'new' ? `<button class="btn btn-primary" onclick="assignTechnician('${booking.id}')">Assign Tech</button>` : ''}
                </div>
            </div>
        `;
    }).join('');
    
    container.innerHTML = bookingsHTML;
}

// Updated stats calculation using your actual columns
function updateStats() {
    const today = new Date().toISOString().split('T')[0];
    const todayBookings = allBookings.filter(b => b.created_at?.startsWith(today));
    
    // Calculate actual revenue from your estimated_cost and final_cost columns
    const todayRevenue = todayBookings.reduce((sum, booking) => {
        return sum + (booking.final_cost || booking.estimated_cost || 280);
    }, 0);
    
    document.getElementById('todayBookings').textContent = todayBookings.length;
    document.getElementById('todayRevenue').textContent = '$' + todayRevenue;
    document.getElementById('totalBookings').textContent = allBookings.length;
}

// Enhanced action functions using your database columns
function updateBookingStatus(id, customerName) {
    const statusOptions = ['new', 'confirmed', 'in-progress', 'completed', 'cancelled'];
    const newStatus = prompt(`Update status for ${customerName}:\n\nOptions:\n• ${statusOptions.join('\n• ')}\n\nEnter new status:`);
    
    if (newStatus && statusOptions.includes(newStatus.toLowerCase())) {
        updateConnectionStatus(`🔄 Updating booking ${id}...`);
        
        // Here you would call Supabase to actually update - for now showing success
        setTimeout(() => {
            updateConnectionStatus(`✅ Booking ${id} updated to ${newStatus.toUpperCase()}`);
            loadAllData(); // Refresh to show updated status
        }, 1000);
    }
}

function viewFullDetails(id) {
    const booking = allBookings.find(b => b.id === id);
    if (booking) {
        let serviceDetails = 'No service details available';
        
        if (booking.service_description) {
            try {
                const service = JSON.parse(booking.service_description);
                serviceDetails = `Service: ${service.service}\nDescription: ${service.description}\nCost: $${service.cost}`;
            } catch (e) {
                serviceDetails = booking.service_description;
            }
        }
        
        const details = `📋 FULL BOOKING DETAILS\n\n` +
               `🎫 BOOKING INFO\n` +
               `DontPark ID: ${booking.dontpark_booking_id || 'N/A'}\n` +
               `Work Order: ${booking.shop_work_order || 'Not assigned'}\n` +
               `Priority Score: ${booking.priority_score || 'Normal'}\n\n` +
               `👤 CUSTOMER\n` +
               `Name: ${booking.customer_name}\n` +
               `Phone: ${booking.customer_phone}\n` +
               `Email: ${booking.customer_email}\n\n` +
               `🚗 VEHICLE\n` +
               `Vehicle: ${booking.year} ${booking.Make_model}\n` +
               `Make: ${booking.car_make}\n` +
               `Color: ${booking.color}\n` +
               `License: ${booking.license_plate}\n` +
               `Mileage: ${booking.car_mileage || 'Not provided'}\n\n` +
               `✈️ FLIGHT INFO\n` +
               `Departure: ${booking.flight_date} at ${booking.flight_time}\n` +
               `Return: ${booking.return_date} at ${booking.arrival_time}\n\n` +
               `🔧 SERVICE\n` +
               `${serviceDetails}\n` +
               `Estimated: $${booking.estimated_cost || 'TBD'}\n` +
               `Final Cost: $${booking.final_cost || 'Pending'}\n` +
               `Commission: $${booking.commission_amount || 'TBD'} (${booking.commission_status || 'Pending'})\n\n` +
               `📝 NOTES\n` +
               `Customer: ${booking.customer_notes || 'None'}\n` +
               `Shop: ${booking.shop_notes || 'None'}\n` +
               `Internal: ${booking.internal_notes || 'None'}\n\n` +
               `📅 TIMELINE\n` +
               `Created: ${new Date(booking.created_at).toLocaleString()}\n` +
               `Updated: ${new Date(booking.updated_at).toLocaleString()}\n` +
               `Completion Time: ${booking.actual_completion_time || 'Pending'}\n` +
               `Status: ${booking.status}\n`;
               
        alert(details);
    }
}

function assignTechnician(id) {
    const tech = prompt('Assign technician to this booking:\n\nEnter technician name:');
    if (tech) {
        updateConnectionStatus(`👨‍🔧 Assigning ${tech} to booking ${id}...`);
        // Here you would update the pickup_driver_id or add a technician field
        setTimeout(() => {
            updateConnectionStatus(`✅ ${tech} assigned to booking ${id}`);
        }, 1000);
    }
}
</script>
</body>
</html>
