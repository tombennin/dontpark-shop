<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8em;
            font-weight: 700;
        }
        
        .shop-info {
            text-align: right;
        }
        
        .claude-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid #3b82f6;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #1e3a8a;
        }
        
        .stat-label {
            color: #64748b;
            font-weight: 500;
            margin-top: 5px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .bookings-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8fafc;
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            font-size: 1.2em;
            color: #1e3a8a;
        }
        
        .booking-card {
            padding: 25px;
            border-bottom: 1px solid #f1f5f9;
            transition: background 0.2s;
        }
        
        .booking-card:hover {
            background: #f8fafc;
        }
        
        .booking-card:last-child {
            border-bottom: none;
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .customer-info {
            flex: 1;
        }
        
        .customer-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 5px;
        }
        
        .vehicle-info {
            color: #64748b;
            margin-bottom: 10px;
        }
        
        .booking-reference {
            color: #64748b;
            font-size: 0.9em;
            margin-top: 5px;
            padding: 8px 12px;
            background: #f8fafc;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        
        .flight-info {
            background: #dbeafe;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            color: #1e40af;
            margin-bottom: 15px;
        }
        
        .claude-diagnosis {
            background: #f0f9ff;
            border: 2px solid #bae6fd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .claude-diagnosis h4 {
            color: #1e40af;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .diagnosis-text {
            color: #374151;
            line-height: 1.5;
        }
        
        .revenue-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #1e40af;
        }
        
        .revenue-info.completed {
            background: #f0fdf4;
            border-color: #bbf7d0;
            color: #166534;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .chat-with-claude {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: #f8fafc;
        }
        
        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 10px;
            max-width: 85%;
        }
        
        .user-message {
            background: #3b82f6;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .claude-message {
            background: white;
            border: 1px solid #e2e8f0;
            margin-right: auto;
        }
        
        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .chat-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            resize: none;
            height: 60px;
        }
        
        .quick-actions {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 25px;
        }
        
        .quick-action {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            text-decoration: none;
            color: #374151;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .quick-action:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-new {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-confirmed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-in-progress {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .notification {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .concierge-timeline {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .timeline-container {
            padding: 20px;
            display: grid;
            grid-template-columns: 80px 1fr 60px;
            gap: 15px;
            align-items: start;
        }
        
        .timeline-hours {
            display: flex;
            flex-direction: column;
            gap: 50px;
            padding-top: 10px;
        }
        
        .hour-label {
            font-weight: 600;
            color: #64748b;
            font-size: 0.9em;
            text-align: right;
        }
        
        .timeline-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .time-slot {
            min-height: 40px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: flex-start;
            background: #f8fafc;
        }
        
        .pickup-block {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            min-width: 80px;
            text-align: center;
        }
        
        .pickup-single {
            background: #10b981;
        }
        
        .pickup-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .pickup-time {
            font-size: 0.7em;
            opacity: 0.9;
        }
        
        .staffing-indicators {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-top: 10px;
        }
        
        .staff-indicator {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1em;
            color: white;
        }
        
        .staff-light {
            background: #10b981;
        }
        
        .staff-medium {
            background: #f59e0b;
        }
        
        .staff-heavy {
            background: #ef4444;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pickup-person {
            font-size: 0.6em;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .staffing-summary {
            background: #f0f9ff;
            border-top: 1px solid #bae6fd;
            padding: 15px 20px;
            color: #1e40af;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">DontPark.ai</div>
            <div class="shop-info">
                <div class="claude-badge">Claude AI Powered ‚ú®</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">7</div>
                <div class="stat-label">Today's Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">$1,960</div>
                <div class="stat-label">Today's Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">42</div>
                <div class="stat-label">This Week</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">4.9‚≠ê</div>
                <div class="stat-label">Average Rating</div>
            </div>
        </div>

        <!-- Flight Delay Notification -->
        <div class="notification">
            ‚ö†Ô∏è <strong>Flight Alert:</strong> WN 1247 delayed 45 minutes. Sarah's pickup automatically rescheduled.
        </div>

        <!-- Concierge Timeline -->
        <div class="concierge-timeline">
            <div class="section-header">Today's Concierge Schedule</div>
            <div class="timeline-container">
                <div class="timeline-hours">
                    <div class="hour-label">12 PM</div>
                    <div class="hour-label">1 PM</div>
                    <div class="hour-label">2 PM</div>
                    <div class="hour-label">3 PM</div>
                    <div class="hour-label">4 PM</div>
                    <div class="hour-label">5 PM</div>
                    <div class="hour-label">6 PM</div>
                    <div class="hour-label">7 PM</div>
                </div>
                <div class="timeline-slots">
                    <div class="time-slot slot-12"></div>
                    <div class="time-slot slot-1"></div>
                    <div class="time-slot slot-2">
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">Sarah M.</div>
                            <div class="pickup-time">2:15 PM</div>
                            <div class="pickup-person">Person 1</div>
                        </div>
                    </div>
                    <div class="time-slot slot-3"></div>
                    <div class="time-slot slot-4">
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">Mike R.</div>
                            <div class="pickup-time">4:00 PM</div>
                            <div class="pickup-person">Person 1</div>
                        </div>
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">Lisa C.</div>
                            <div class="pickup-time">4:15 PM</div>
                            <div class="pickup-person">Person 2</div>
                        </div>
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">Tom W.</div>
                            <div class="pickup-time">4:30 PM</div>
                            <div class="pickup-person">Person 1</div>
                        </div>
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">Amy S.</div>
                            <div class="pickup-time">4:45 PM</div>
                            <div class="pickup-person">Person 2</div>
                        </div>
                    </div>
                    <div class="time-slot slot-5">
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">David K.</div>
                            <div class="pickup-time">5:10 PM</div>
                            <div class="pickup-person">Person 1</div>
                        </div>
                        <div class="pickup-block pickup-single">
                            <div class="pickup-name">Maria L.</div>
                            <div class="pickup-time">5:25 PM</div>
                            <div class="pickup-person">Person 2</div>
                        </div>
                    </div>
                    <div class="time-slot slot-6"></div>
                    <div class="time-slot slot-7"></div>
                </div>
                <div class="staffing-indicators">
                    <div class="staff-indicator staff-light">1</div>
                    <div class="staff-indicator staff-light">1</div>
                    <div class="staff-indicator staff-light">1</div>
                    <div class="staff-indicator staff-light">1</div>
                    <div class="staff-indicator staff-medium">2</div>
                    <div class="staff-indicator staff-medium">2</div>
                    <div class="staff-indicator staff-light">1</div>
                    <div class="staff-indicator staff-light">1</div>
                </div>
            </div>
            <div class="staffing-summary">
                <strong>Total Concierges Needed Today:</strong> 2 people maximum (Person 1 & Person 2)
            </div>
        </div>

        <div class="main-content">
            <!-- Bookings Section -->
            <div class="bookings-section">
                <div class="section-header">Today's Bookings & Services</div>
                
                <!-- Booking 1 - New -->
                <div class="booking-card">
                    <div class="booking-header">
                        <div class="customer-info">
                            <div class="customer-name">Sarah Mitchell <span class="status-badge status-new">NEW</span></div>
                            <div class="vehicle-info">2019 Honda Civic ‚Ä¢ 67,000 miles</div>
                            <div class="booking-reference">
                                <strong>DP#:</strong> DP-240814-001 | <strong>Work Order:</strong> 
                                <input type="text" placeholder="Enter your work order #" style="border: 1px solid #d1d5db; padding: 4px 8px; border-radius: 4px; margin-left: 5px; width: 150px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flight-info">
                        ‚úàÔ∏è <strong>Flight:</strong> WN 1247 ‚Ä¢ Departs: 3:45 PM (DELAYED +45 min) ‚Ä¢ Pickup: 1:30 PM ‚Üí 2:15 PM
                    </div>
                    
                    <div class="claude-diagnosis">
                        <h4>ü§ñ Claude's Diagnosis</h4>
                        <div class="diagnosis-text">
                            <strong>Customer described:</strong> "Grinding noise when I turn, especially from parking lots"<br>
                            <strong>Claude's assessment:</strong> Likely CV joint wear. Common in vehicles with 60k+ miles. Symptoms match outer CV joint failure pattern. Recommend inspection of both front CV joints and boots. Estimated repair: $280-320 per side if replacement needed.
                        </div>
                    </div>
                    
                    <div class="revenue-info">
                        <strong>Shop Revenue:</strong> $276.00
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="confirmBooking('sarah')">Confirm Booking</button>
                        <button class="btn btn-secondary" onclick="askClaude('cv-joint-questions')">Ask Claude More</button>
                        <button class="btn btn-secondary" onclick="callCustomer('sarah')">Call Customer</button>
                    </div>
                </div>

                <!-- Booking 2 - Confirmed -->
                <div class="booking-card">
                    <div class="booking-header">
                        <div class="customer-info">
                            <div class="customer-name">Mike Rodriguez <span class="status-badge status-confirmed">CONFIRMED</span></div>
                            <div class="vehicle-info">2017 Ford F-150 ‚Ä¢ 89,000 miles</div>
                            <div class="booking-reference">
                                <strong>DP#:</strong> DP-240814-002 | <strong>Work Order:</strong> WO-45782
                            </div>
                        </div>
                    </div>
                    
                    <div class="flight-info">
                        ‚úàÔ∏è <strong>Flight:</strong> AA 2156 ‚Ä¢ Departs: 6:20 PM ‚Ä¢ Pickup: 4:00 PM
                    </div>
                    
                    <div class="claude-diagnosis">
                        <h4>ü§ñ Claude's Diagnosis</h4>
                        <div class="diagnosis-text">
                            <strong>Customer described:</strong> "Truck pulls to the right, steering wheel vibrates"<br>
                            <strong>Claude's assessment:</strong> Alignment issue combined with possible warped brake rotors. Check tire wear patterns first, then test drive to confirm brake rotor warping. Likely needs 4-wheel alignment ($89) and front brake rotor replacement ($240).
                        </div>
                    </div>
                    
                    <div class="revenue-info">
                        <strong>Shop Revenue:</strong> $302.68
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="startService('mike')">Start Service</button>
                        <button class="btn btn-secondary" onclick="viewHistory('mike')">View Chat History</button>
                    </div>
                </div>

                <!-- Booking 3 - In Progress -->
                <div class="booking-card">
                    <div class="booking-header">
                        <div class="customer-info">
                            <div class="customer-name">Jennifer Kim <span class="status-badge status-in-progress">IN PROGRESS</span></div>
                            <div class="vehicle-info">2020 Toyota RAV4 ‚Ä¢ 43,000 miles</div>
                            <div class="booking-reference">
                                <strong>DP#:</strong> DP-240813-015 | <strong>Work Order:</strong> WO-45799
                            </div>
                        </div>
                    </div>
                    
                    <div class="flight-info">
                        ‚úàÔ∏è <strong>Flight:</strong> DL 891 ‚Ä¢ Returns: Tomorrow 8:30 AM
                    </div>
                    
                    <div class="claude-diagnosis">
                        <h4>ü§ñ Service Update</h4>
                        <div class="diagnosis-text">
                            <strong>Original issue:</strong> "Air conditioning not cooling properly"<br>
                            <strong>Current status:</strong> A/C system diagnosed - low refrigerant due to small leak in condenser. Condenser replacement in progress. Customer approved $420 repair via text.
                        </div>
                    </div>
                    
                    <div class="revenue-info completed">
                        <strong>Final Shop Revenue:</strong> $386.40
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="updateCustomer('jennifer')">Update Customer</button>
                        <button class="btn btn-success" onclick="completeService('jennifer')">Mark Complete</button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Chat with Claude -->
                <div class="chat-with-claude">
                    <div class="section-header">Ask Claude Anything</div>
                    <div class="chat-messages" id="claudeChat">
                        <div class="chat-message claude-message">
                            <strong>Claude:</strong> Hi! I'm here to help with any automotive questions. What would you like to know?
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <textarea class="chat-input" placeholder="Ask Claude about diagnostics, customer communication, or anything else..." onkeypress="handleChatKeyPress(event)"></textarea>
                        <button class="btn btn-primary" style="margin-top: 10px; width: 100%;" onclick="sendToClaude()">Ask Claude</button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="section-header" style="padding: 0; background: none; border: none; margin-bottom: 15px;">Quick Actions</div>
                    <a href="#" class="quick-action" onclick="checkFlights()">‚úàÔ∏è Check Flight Status</a>
                    <a href="#" class="quick-action" onclick="viewSchedule()">üìÖ View Tomorrow's Schedule</a>
                    <a href="#" class="quick-action" onclick="customerFeedback()">‚≠ê Customer Feedback</a>
                    <a href="#" class="quick-action" onclick="testSupabaseConnection()" style="background: #dbeafe; border-color: #3b82f6;">üß™ Test Supabase Connection</a>
                    <a href="#" class="quick-action" onclick="createTestBooking()" style="background: #f0fdf4; border-color: #10b981;">‚ûï Create Test Booking</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Force show all errors and logs
        console.clear();
        
        // Override console to ensure we see everything
        const originalError = console.error;
        const originalLog = console.log;
        const originalWarn = console.warn;
        
        console.error = function(...args) {
            originalError.apply(console, ['üî• ERROR:', ...args]);
            alert('ERROR DETECTED: ' + args.join(' '));
        };
        
        console.log = function(...args) {
            originalLog.apply(console, ['üìù LOG:', ...args]);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, ['‚ö†Ô∏è WARN:', ...args]);
        };
        
        // Catch all unhandled errors
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Unhandled Error:', msg, 'at', url, 'line', lineNo);
            alert('UNHANDLED ERROR: ' + msg);
            return false;
        };
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled Promise Rejection:', event.reason);
            alert('PROMISE REJECTION: ' + event.reason);
        });
        
        console.log('üöÄ Script is starting to run!');
        console.log('üìç Current timestamp:', new Date().toISOString());
        
        // Check what's available in window
        console.log('ü™ü Window object keys containing "supabase":', Object.keys(window).filter(k => k.toLowerCase().includes('supabase')));
        console.log('ü™ü Window object keys containing "create":', Object.keys(window).filter(k => k.toLowerCase().includes('create')));
        
        // Try different ways to access Supabase
        console.log('üîç Checking Supabase availability...');
        console.log('typeof window.supabase:', typeof window.supabase);
        console.log('typeof createClient:', typeof createClient);
        console.log('typeof window.createClient:', typeof window.createClient);
        console.log('window.supabase object:', window.supabase);
        
        // Check if script loaded
        const scripts = document.querySelectorAll('script[src*="supabase"]');
        console.log('üìú Supabase script tags found:', scripts.length);
        scripts.forEach((script, i) => {
            console.log(`Script ${i}:`, script.src, 'loaded:', script.readyState);
        });
        
        // Wait for everything to load
        function initializeApp() {
            console.log('üéØ initializeApp called');
            
            // Try multiple ways to get createClient
            let createClientFunc = null;
            
            if (typeof createClient !== 'undefined') {
                createClientFunc = createClient;
                console.log('‚úÖ Found createClient in global scope');
            } else if (window.supabase && window.supabase.createClient) {
                createClientFunc = window.supabase.createClient;
                console.log('‚úÖ Found createClient in window.supabase');
            } else if (window.createClient) {
                createClientFunc = window.createClient;
                console.log('‚úÖ Found createClient in window');
            } else {
                console.error('‚ùå createClient not found anywhere!');
                console.log('Available window properties:', Object.keys(window).slice(0, 20));
                return;
            }
            
            console.log('üìÑ Page loaded, checking Supabase again...');
            console.log('typeof createClientFunc:', typeof createClientFunc);
            
            // ============================================
            // SUPABASE CONFIGURATION 
            // ============================================
            const SUPABASE_URL = 'https://uhrhukcovvvbmopvoncr.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVocmh1a2NvdnZ2Ym1vcHZvbmNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1MzIyMzcsImV4cCI6MjA3MDEwODIzN30.Ce69ktLB8h_OMe0H1XpDmRjKZawGlb59ProIs8UEaRw';
            
            console.log('‚öôÔ∏è Supabase configuration:');
            console.log('URL:', SUPABASE_URL);
            console.log('Key length:', SUPABASE_ANON_KEY.length);
            
            // Check if createClient function exists
            if (!createClientFunc) {
                console.error('‚ùå createClientFunc is null! Supabase library may not have loaded.');
                alert('‚ùå Supabase library not loaded! Check console for details.');
                return;
            }
            
            console.log('‚úÖ createClient function is available');
            
            // Create global supabase client with error handling
            let supabase;
            try {
                supabase = createClientFunc(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase client created successfully:', supabase);
                console.log('üîß Supabase client methods:', Object.keys(supabase));
                
                // Store globally for access from other functions
                window.supabaseClient = supabase;
                
                alert('‚úÖ Supabase client created successfully!');
            } catch (error) {
                console.error('‚ùå Error creating Supabase client:', error);
                alert('‚ùå Error creating Supabase client: ' + error.message);
                return;
            }
            
            // Load real bookings from Supabase
            async function loadBookings() {
                try {
                    console.log('üîÑ Attempting to connect to Supabase...');
                    console.log('Supabase URL:', SUPABASE_URL);
                    console.log('Supabase client:', supabase);
                    
                    // Test connection first
                    const { data: testData, error: testError } = await supabase
                        .from('bookings')
                        .select('count', { count: 'exact', head: true });
                    
                    if (testError) {
                        console.error('‚ùå Supabase connection test failed:', testError);
                        showConnectionStatus('failed', testError.message);
                        return;
                    }
                    
                    console.log('‚úÖ Supabase connection successful!');
                    console.log('üìä Total bookings count:', testData);
                    
                    const { data: bookings, error } = await supabase
                        .from('bookings')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        console.error('‚ùå Error loading bookings:', error);
                        showConnectionStatus('error', error.message);
                        return;
                    }
                    
                    console.log('‚úÖ Successfully loaded bookings:', bookings);
                    console.log('üìà Number of bookings retrieved:', bookings?.length || 0);
                    
                    showConnectionStatus('success', `Loaded ${bookings?.length || 0} bookings`);
                    displayBookings(bookings);
                    
                } catch (error) {
                    console.error('üí• Database connection error:', error);
                    showConnectionStatus('failed', error.message);
                }
            }
            
            // Display bookings in the UI
            function displayBookings(bookings) {
                console.log('üé® Displaying bookings in UI:', bookings);
                
                if (!bookings || bookings.length === 0) {
                    console.log('üì≠ No bookings to display - showing static demo data');
                    return;
                }
                
                // TODO: Replace static booking cards with real data
                console.log('üîÑ Would replace static booking cards with:', bookings);
                
                // For now, just update the stats with real data
                updateStatsFromData(bookings);
            }
            
            // Update stats with real data
            function updateStatsFromData(bookings) {
                const today = new Date().toISOString().split('T')[0];
                const todayBookings = bookings.filter(booking => 
                    booking.created_at?.startsWith(today)
                );
                
                // Update the stats display
                const statCards = document.querySelectorAll('.stat-number');
                if (statCards[0]) statCards[0].textContent = todayBookings.length;
                
                console.log(`üìä Updated stats: ${todayBookings.length} bookings today`);
            }
            
            // Show connection status in the UI
            function showConnectionStatus(status, message) {
                // Remove any existing status indicator
                const existingStatus = document.querySelector('.supabase-status');
                if (existingStatus) existingStatus.remove();
                
                // Create status indicator
                const statusDiv = document.createElement('div');
                statusDiv.className = 'supabase-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 1000;
                    animation: slideIn 0.3s ease-out;
                `;
                
                switch(status) {
                    case 'success':
                        statusDiv.style.background = '#10b981';
                        statusDiv.style.color = 'white';
                        statusDiv.innerHTML = `‚úÖ Supabase: ${message}`;
                        break;
                    case 'error':
                        statusDiv.style.background = '#ef4444';
                        statusDiv.style.color = 'white';
                        statusDiv.innerHTML = `‚ùå Supabase Error: ${message}`;
                        break;
                    case 'failed':
                        statusDiv.style.background = '#f59e0b';
                        statusDiv.style.color = 'white';
                        statusDiv.innerHTML = `‚ö†Ô∏è Supabase: ${message}`;
                        break;
                }
                
                document.body.appendChild(statusDiv);
                
                // Auto-remove after 5 seconds
                setTimeout(() => statusDiv.remove(), 5000);
            }
            
            // Add CSS for animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Load bookings when page loads
            loadBookings();
        });
        
        function confirmBooking(customer) {
            alert(`Booking confirmed for ${customer}! Pickup reminder set for 1 hour before scheduled time.`);
            // Update status badge to confirmed
            event.target.closest('.booking-card').querySelector('.status-badge').textContent = 'CONFIRMED';
            event.target.closest('.booking-card').querySelector('.status-badge').className = 'status-badge status-confirmed';
        }

        function askClaude(topic) {
            const responses = {
                'cv-joint-questions': "Great question! For CV joint diagnosis, ask the customer: 1) Does the grinding happen more when turning left or right? 2) Any clicking sounds when backing out of parking spaces? 3) Have they noticed any grease on the inner wheel wells? These details will help confirm which side needs replacement."
            };
            
            addClaudeMessage(responses[topic] || "I'm here to help with any diagnostic questions!");
        }

        function callCustomer(customer) {
            alert(`Calling ${customer}... (This would integrate with your phone system)`);
        }

        function startService(customer) {
            alert(`Service started for ${customer}. Timer activated and customer notified.`);
        }

        function viewHistory(customer) {
            alert(`Opening chat history for ${customer}...`);
        }

        function updateCustomer(customer) {
            alert(`Sending update to ${customer}: "A/C repair in progress, will be ready by 7 AM as scheduled."`);
        }

        function completeService(customer) {
            alert(`Service marked complete for ${customer}. Customer charged and receipt sent.`);
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendToClaude();
            }
        }

        function sendToClaude() {
            const input = document.querySelector('.chat-input');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addUserMessage(message);
            input.value = '';

            // Simulate Claude response
            setTimeout(() => {
                const response = generateClaudeResponse(message);
                addClaudeMessage(response);
            }, 1000);
        }

        function addUserMessage(message) {
            const chatContainer = document.getElementById('claudeChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message user-message';
            messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function addClaudeMessage(message) {
            const chatContainer = document.getElementById('claudeChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message claude-message';
            messageDiv.innerHTML = `<strong>Claude:</strong> ${message}`;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function generateClaudeResponse(message) {
            const responses = [
                "For that type of issue, I'd recommend checking the most common causes first. What specific symptoms did the customer describe?",
                "That sounds like a classic case. Here's what I'd suggest checking first, and then the follow-up questions to ask the customer...",
                "Great question! Based on the symptoms, here are the diagnostic steps I'd recommend, in order of likelihood...",
                "For customer communication about that repair, I'd suggest explaining it this way: [simple explanation]. Would you like me to draft a text message?"
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Add a test Supabase button for manual testing
        function testSupabaseConnection() {
            console.log('üß™ Manual Supabase test initiated...');
            if (typeof loadBookings === 'function') {
                loadBookings();
            } else {
                console.error('loadBookings function not available');
            }
        }
        
        // Add a button to create test data
        async function createTestBooking() {
            try {
                const testBooking = {
                    customer_name: 'Test Customer',
                    vehicle_info: '2020 Test Car',
                    issue_description: 'Test issue for debugging',
                    flight_info: 'TEST123',
                    status: 'new',
                    created_at: new Date().toISOString()
                };
                
                console.log('üìù Creating test booking:', testBooking);
                
                if (!window.supabaseClient) {
                    alert('Supabase client not available');
                    return;
                }
                
                const { data, error } = await window.supabaseClient
                    .from('bookings')
                    .insert([testBooking])
                    .select();
                
                if (error) {
                    console.error('‚ùå Error creating test booking:', error);
                    alert(`Error creating test booking: ${error.message}`);
                } else {
                    console.log('‚úÖ Test booking created:', data);
                    alert('Test booking created successfully!');
                    if (typeof loadBookings === 'function') {
                        loadBookings();
                    }
                }
            } catch (error) {
                console.error('üí• Error in createTestBooking:', error);
                alert(`Error: ${error.message}`);
            }
        }

        // Quick action functions
        function checkFlights() {
            alert("Flight Status:\n‚úÖ WN 1247: Delayed +45 min\n‚úÖ AA 2156: On time\n‚úÖ DL 891: On time");
        }

        function viewSchedule() {
            alert("Tomorrow's Schedule:\n8:00 AM - Jennifer Kim pickup\n10:30 AM - New booking: Tom Wilson\n2:15 PM - New booking: Lisa Chen");
        }

        function customerFeedback() {
            alert("Recent Reviews:\n‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'Claude's diagnosis was spot on!' - Mike R.\n‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 'Saved me $200 vs the dealer' - Sarah M.");
        }

        function supportTicket() {
            alert("Opening support ticket system... (This would connect to DontPark support)");
        }

        function viewEarnings() {
            alert("Monthly Earnings:\nThis Month: $12,450\nLast Month: $11,200\nAverage/booking: $280");
        }
    </script>
</body>
</html>
